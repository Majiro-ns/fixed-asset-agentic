---
title: "AIが「止まる」ことに価値がある ― 固定資産判定システムで実現したStop-first Agentic AI"
emoji: "🛑"
type: "idea"
topics: ["gch4", "googlecloud", "agenticai", "fastapi", "経理DX"]
published: false
---

# AIが「止まる」ことに価値がある

## はじめに：経理現場の「疑えない」問題

月末の経理部門。机には未処理の見積書が山積みになっている。

「この工事、固定資産？それとも費用？」

経理担当者は考える。でも、月末の締め作業に追われて**判断を疑う余裕がない**。結局、「去年と同じ処理でいいか」と決めてしまう。

---

AIによる自動化が進む今、こんな声を聞くようになった。

> 「AIが判定してくれるなら、そのまま採用すればいいじゃないか」

本当にそれでいいのだろうか？

**AIの自動化は、「疑えない状況」を解消するどころか、誤った判断を高速に通過させてしまうリスクを持っている。**

本記事では、この問題に対する私たちの答え ―「**AIが止まる**」ことを価値とするAgentic AIシステムを紹介する。

---

## プロジェクト概要

**見積書 固定資産判定システム**は、見積書の明細行を分析し、固定資産として計上すべきか、費用として処理すべきかを判定するシステムである。

ただし、このシステムには他のAI自動化ツールと決定的に違う点がある。

**判断が難しい場面では、自律的に「止まる」。**

```
┌────────────────────────────────────────────────────────────┐
│                    Agentic AI の再定義                      │
│                                                            │
│  自律 ≠ すべてを自動で処理すること                          │
│  自律 = 判断を「行う」か「止める」かを選択できること          │
└────────────────────────────────────────────────────────────┘
```

これを私たちは **Stop-first設計** と呼んでいる。

---

## 対象ユーザー

このシステムは、以下のような方々の課題を解決するために開発された。

### メインターゲット

| ユーザー | 課題 | 本システムでの解決 |
|---------|------|-------------------|
| **中小企業の経理担当者** | 判断の属人化、月末の時間不足 | 要確認項目（GUIDANCE）のみに集中できる |
| **会計事務所スタッフ** | 複数クライアントの一括処理 | ポリシー設定で会社別ルールを管理 |
| **税理士** | 判断が割れる案件の確認 | 判定根拠（Evidence）を即座に確認 |

### こんな場面で使える

- 毎月末の見積書処理（10〜20件/月の中小企業）
- 大型設備投資の判定（付帯工事の取扱い確認）
- 税務調査対応（3年前の判断根拠を説明）
- 新人経理担当者の教育（実例ベースで判断基準を学習）

---

## 解決する課題

### Before：従来のAI自動化の問題

```
見積書 → AIが自動判定 → 結果を採用 → （数年後）税務調査で否認
                               ↑
                        「なぜこの処理にした？」
                        「AIが判定したから...」
```

**問題点：**
1. AIの「断定癖」 ― 不確実でも何かしら答えを出してしまう
2. 責任の曖昧さ ― AIが判定したのか、人間が判断したのか不明確
3. 判断根拠の消失 ― 後から「なぜ」を説明できない

### After：Stop-first設計による解決

```
見積書 → AIが分析 → GUIDANCE（要確認）→ 人間が判断 → 証跡を保存
                         ↓
                   "撤去"を検出
                   "判断が割れる可能性"
                   "追加情報が必要"
```

**解決ポイント：**
1. 3値判定 ― CAPITAL_LIKE / EXPENSE_LIKE / **GUIDANCE（判定しない）**
2. 明確な責任分界点 ― AIは「要確認」を出し、人間が最終判断
3. 完全な証跡 ― flags, evidence, traceを記録

---

## ソリューション：Stop-first設計

### 3値判定モデル

本システムは、明細行を以下の3つの値で判定する。

| 判定 | 意味 | AIの行動 |
|------|------|----------|
| **CAPITAL_LIKE** | 資産寄り | 自動判定（採用推奨） |
| **EXPENSE_LIKE** | 費用寄り | 自動判定（採用推奨） |
| **GUIDANCE** | 要確認 | **判定を停止**、人間に委ねる |

### なぜ「止まる」のか？

以下の条件を検出すると、システムは自律的に判定を停止する。

```python
# 判断が割れるキーワード
MIXED_KEYWORDS = ["一式", "撤去", "移設", "既設", "更新"]

# 金額閾値（税務ルール）
# 10〜20万円：3年一括償却の確認必要
# 20〜30万円：一括償却/中小企業特例要確認
# 60万円以上：修繕費vs資本的支出の判定必要
```

**GUIDANCEは「誤判定」ではない。**

> 判断が割れる行を検知し、
> 人が確認すべき箇所を明示するための
> **意図的な停止** である。

### 5ステップのAgenticループ

1. **止まる（GUIDANCE）** ― 判断が割れる可能性がある場合、自動判定を停止
2. **根拠提示** ― Evidence（判定根拠）とMissing Fields（不足情報）を明示
3. **質問** ― `why_missing_matters`でなぜその情報が必要かを説明
4. **再実行** ― `answers`フィールドで不足情報を補完し再分類
5. **差分保存** ― Before → After の Decision/Confidence/Trace を表示

---

## 技術スタック

### システム構成図

```mermaid
graph TB
    A[見積書PDF] -->|Opal OCR| B[Opal JSON]
    B -->|Streamlit UI| C[ユーザー入力]
    C -->|POST /classify| D[Cloud Run<br/>FastAPI]
    D -->|Adapter| E[正規化スキーマ]
    E -->|Classifier| F{判定結果}
    F -->|CAPITAL_LIKE<br/>EXPENSE_LIKE| G[判定完了]
    F -->|GUIDANCE| H[不足情報提示]
    H -->|Vertex AI Search| I[法令エビデンス]
    I -->|Citations| D
    H -->|ユーザー回答| J[再実行]
    J -->|answers| D
    D -->|diff表示| K[Before → After]

    style D fill:#4285f4,stroke:#1a73e8,color:#fff
    style I fill:#ea4335,stroke:#c5221f,color:#fff
    style F fill:#fbbc04,stroke:#f9ab00,color:#000
```

### 使用技術

| カテゴリ | 技術 | 用途 |
|---------|------|------|
| **API** | FastAPI + Pydantic | REST API、スキーマ検証 |
| **PDF処理** | Document AI / PyMuPDF | PDF → テキスト抽出 |
| **法令検索** | Vertex AI Search | 関連法令のエビデンス検索 |
| **デプロイ** | Cloud Run | サーバーレスAPIホスティング |
| **UI** | Streamlit | デモ用Webインターフェース |

### Google Cloud AIの活用

| サービス | 役割 | Feature Flag |
|---------|------|-------------|
| **Document AI** | PDF抽出（高精度OCR） | `USE_DOCAI=1` |
| **Vertex AI Search** | 法令・規則の根拠検索 | `VERTEX_SEARCH_ENABLED=1` |
| **Cloud Run** | APIのデプロイ・運用 | 常時有効 |

---

## デモ

:::message
デモ動画は別途撮影・埋め込み予定
:::

### デモシナリオ

**シナリオ：重機購入の見積書判定**

1. 見積書PDF（本体2,500万円 + 据付工事300万円 + 撤去150万円）をアップロード
2. システムが明細を抽出・判定
   - 本体：**CAPITAL_LIKE**（資産寄り）
   - 据付工事：**GUIDANCE**（flags: 付帯工事）
   - 撤去：**GUIDANCE**（flags: 撤去）
3. GUIDANCE項目について、不足情報を確認
   - 「据付工事は取得価額に含めるか？」
   - 「撤去は新規資産の取得に必要な除去費用か？」
4. 追加情報を入力して再判定
5. 最終判定と証跡をエクスポート

### 再現手順（ローカル）

```bash
# Dockerで起動（3分以内で動作確認可能）
docker build -t fixed-asset-api .
docker run -p 8080:8080 -e PORT=8080 fixed-asset-api

# ヘルスチェック
curl http://localhost:8080/health
# → {"ok": true}
```

---

## 今後の展望

### 短期（3-6ヶ月）

- **Document AI本格統合**：`USE_DOCAI=1`をデフォルト化
- **Vertex AI Search常時有効化**：法令エビデンス検索の本格利用
- **Golden Setの拡充**：10 → 50ケースへ

### 中期（1-2年）

- **他帳票への横展開**：請求書、領収書、注文書
- **耐用年数マスタ連携**：候補提示と根拠提示（Stop-first設計維持）
- **ワークフロー統合**：会計システム、経費精算システムとの連携

### 長期（3年以上）

- **判断支援AIのプラットフォーム化**：固定資産判定に限らず、あらゆる業務判断に適用
- **グローバル対応**：US GAAP / IFRS 16対応

---

## まとめ

### キーメッセージ

> **「AIが賢くなる」ではなく「AIが止まる」ことに価値がある。**

経理現場では、月末・決算期に判断を疑う余裕がない。
そこにAIの自動化を入れると、誤った判断を高速に通過させてしまう。

本システムは、判断が割れる場面で**自律的に停止**し、
人間に確認すべきポイントを明示する。

これが「Agentic AI」の新しい定義 ―
**判断を行う／止めるを選択できる自律性**。

### Stop-first設計の価値

| 観点 | 従来のAI自動化 | Stop-first設計 |
|------|---------------|----------------|
| 判定方式 | 全自動（強制判定） | 3値判定（止まれる） |
| 責任境界 | 曖昧 | 明確（人間/AI分界点） |
| 監査対応 | 事後説明困難 | 判定根拠トレース可能 |
| 導入リスク | 高（誤判定リスク） | 低（不明時は停止） |

---

## 参考リンク

- [GitHub リポジトリ](#)（後日公開予定）
- [Cloud Run デプロイ版](#)（デモ用URL）
- [DEMO_RUNBOOK.md](./DEMO_RUNBOOK.md)：3-4分のデモ手順

---

*本記事は、第4回 Agentic AI Hackathon with Google Cloud への参加プロジェクトとして執筆されました。*
