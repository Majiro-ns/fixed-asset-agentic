# 技術的差別化分析

**作成者**: 足軽7号（ペルソナ: テック系ハッカソン審査員経験者）
**タスクID**: subtask_068_07
**日時**: 2026-02-10

---

## 現在の差別化ポイント（強み）

### 差別化1: Stop-first / Fail-to-GUIDANCE 設計（最大の差別化）

**概要**: AIが「わからない」ときに**推測せず止まる**設計。他のAIツールが「最善の回答を出す」のに対し、本ツールは確信がないときGUIDANCEを返す。

**技術的実装**:
- `core/classifier.py`: キーワード競合（資産系+費用系が両方ヒット）→ GUIDANCE
- `core/classifier.py`: キーワードゼロヒット → GUIDANCE（「情報不足」フラグ付き）
- `policies/company_default.json`: 正規表現 `"always_guidance": ".*(撤去|移設).*"` で特定パターンを強制GUIDANCE
- `api/gemini_classifier.py`: システムプロンプトに「少しでも判断に迷う場合はGUIDANCEを返す（推測・断定禁止）」を明記
- 税額閾値（10万/20万/30万/60万円）: 判断が分かれる金額帯で自動GUIDANCE

**なぜ「止まる」が差別化になるか**:
- 税務ドメインでは**誤判定のコストが巨大**（過少申告加算税、重加算税）
- 「80%の確率で正しい」は残り20%が致命傷になりうる
- 先行事例22件中、**「止まる」を設計原則にしたツールは0件**
- 多くのAI会計ツールは信頼度スコアを返すが、判定自体は必ず出す（Fail-to-Answer）
- 本ツールは**Fail-to-GUIDANCE**（判定しない選択肢を返す）

**審査員への一言**: 「AIが『わかりません』と言えるのは、技術的な弱さではなく設計上の強さです。」

---

### 差別化2: Agentic 3フェーズ設計（止まる→聞く→変わる）

**概要**: GUIDANCE発動後、ユーザーとの対話で判定を完成させるAgenticループ。

**3フェーズの流れ**:
```
Phase 1: 止まる（Stop）
  classifier.py → GUIDANCE判定 → guidance_panel.py起動

Phase 2: 聞く（Ask）
  Step 1: 「修繕・維持」or「新規購入・増強」の2択
  Step 2: 詳細質問（修繕頻度 or 入替の有無）
  → 2段階ウィザードで段階的に情報を収集

Phase 3: 変わる（Change）
  ユーザー回答 → 判定結果更新 → diff_display.pyで変化を可視化
  「GUIDANCE → CAPITAL_LIKE」等の遷移をBefore/Afterで表示
```

**技術的実装**:
- `ui/components/guidance_panel.py`: 594行の2段階ウィザードUI。プログレスインジケータ付き
- `ui/components/diff_display.py`: 判定変化のBefore/After差分表示（確信度変化・理由変化を含む）
- `ui/app_minimal.py`: `_handle_guidance_choice()` でGUIDANCE→確定への状態遷移を管理
- `api/main.py`: `/classify` エンドポイントのagenticループ（answers提供時に再判定）

**先行事例との差**: 22件中「AI提案→人間承認」モデルは複数あるが、**AIが能動的に質問を段階的に投げかけ、回答に応じて判定が変わる**設計は0件。

---

### 差別化3: 外部化されたポリシーエンジン

**概要**: 判定ルールをコードから分離し、JSONファイルで企業ごとにカスタマイズ可能。

**技術的実装**:
- `policies/company_default.json`: キーワード辞書、金額閾値、正規表現パターンの3軸
  - `keywords.asset_add`: 資産判定キーワードの追加
  - `keywords.guidance_add`: 強制GUIDANCE対象キーワード
  - `thresholds.guidance_amount_jpy`: 金額ベースのGUIDANCE閾値
  - `regex.always_guidance`: 正規表現による強制GUIDANCE
- `core/classifier.py`: ポリシーをマージして判定（デフォルトキーワード + 企業固有キーワード）
- `api/main.py`: `policy_path` パラメータでエンドポイントからポリシー切替可能

**なぜ差別化になるか**:
- 先行22件の全ツールはルールがコードにハードコード
- 本ツールは「同じエンジン、違うルール」= **プラットフォーム的拡張性**
- 設備会社、IT企業、製造業など業種ごとにポリシーを変えられる
- 税理士が自社のルールをJSONで定義可能（プログラミング不要）

---

### 差別化4: 税務知識注入プロンプト

**概要**: Geminiシステムプロンプトに日本の税法知識を体系的に注入。

**注入されている知識体系**:
1. **取得価額の範囲**: 含めるもの（付随費用、据付費等）/ 含めないもの（撤去費、登録免許税等）
2. **資本的支出 vs 修繕費の判定基準**: 3年周期ルール、20万円未満ルール、60万円ルール
3. **少額資産の特例**: 10万/20万/30万円の閾値と処理方法
4. **書類全体の文脈判断**: 付随費用の合算、書類タイトル・取引先の考慮

**先行事例との差**: OCR+LLM系ツールは「抽出→構造化」が主目的。**税法の判定基準そのものをプロンプトに埋め込んだ**ツールは調査範囲で0件。

---

### 差別化5: 多層分類アーキテクチャ + フォールバック設計

**概要**: Gemini（LLM）→ ルールベース分類器 → ポリシーエンジン → 税額ルールの4層。いずれかが失敗しても次の層で処理継続。

**技術的実装**:
```
Layer 1: Gemini API（LLM判定）
  ↓ 失敗時フォールバック
Layer 2: core/classifier.py（キーワードベース判定）
  ↓ 常時適用
Layer 3: policies/（企業ポリシーによる上書き・GUIDANCE強制）
  ↓ 常時適用
Layer 4: _apply_tax_rules（金額閾値による安全弁）
```

- Gemini障害時も**ルールベースが即座にテイクオーバー**（ゼロダウンタイム）
- 各層は独立動作し、**どの層もGUIDANCEに倒す方向にのみ上書き可能**（安全側一方通行）

---

## 先行事例との比較表

| 比較軸 | fixed-asset-ashigaru | Zenn先行事例（22件の典型） |
|--------|---------------------|--------------------------|
| **不確実時の振る舞い** | GUIDANCE返却（判定しない） | 信頼度スコア付きで判定を返す |
| **ユーザー対話** | 2段階ウィザード型質問 | 判定結果の手動修正のみ |
| **判定変化の可視化** | Before/After差分表示 | なし（上書き） |
| **ルールの外部化** | JSON企業ポリシー | コードにハードコード |
| **税務知識** | プロンプトに体系的注入 | なし（汎用OCR+LLM） |
| **対象ドメイン** | 固定資産/経費の二値+停止 | 請求書OCR、レシート仕分け等 |
| **フォールバック** | LLM→ルール→ポリシー→税則 | 単一パイプライン |
| **UI設計** | Agentic（AIが質問を投げる） | パッシブ（結果表示のみ） |

### 設計パターン別の位置づけ

| パターン | 先行事例 | fixed-asset-ashigaru |
|---------|---------|---------------------|
| A: LLM直接型 | 2件（精度約60%） | 該当せず |
| B: OCR+LLMハイブリッド | 5件（精度約70-80%） | ベースはこれに近い |
| C: 三層型（OCR+LLM+ルール） | 2件（精度約80%） | **これ + Stop-first + ポリシーエンジン** |
| D: LLM蒸留型 | 1件 | 該当せず |

→ **パターンCの進化形**。三層構造にStop-first原則とAgenticループを組み合わせた設計は先行事例に存在しない。

---

## 審査員への訴求ポイント（推奨表現）

### ピッチの核心（30秒版）

> 「AIが間違えた判定を出すと、税務申告の修正や加算税のリスクがあります。
> 私たちのツールは**AIが『わかりません』と正直に言える**唯一の固定資産判定ツールです。
> 止まったAIがユーザーに質問を投げ、回答に応じて判定が変わる — これがAgentic設計です。」

### 技術的訴求（3分版）

**1. Stop-first原則（Fail-to-GUIDANCE）**
- 「多くのAIツールは信頼度80%でも判定を返します。私たちは**信頼度が足りなければ判定しません**。」
- 「税務の世界では、間違った回答より**『わからない』が正しい回答**になることがあります。」

**2. Agentic Loop（止まる→聞く→変わる）**
- 「止まったAIは沈黙しません。**ユーザーに段階的に質問を投げ**、回答に応じて判定が完成します。」
- 「修繕か新規購入か → 定期修繕か初回か。たった2ステップで判定が確定します。」
- 「判定の変化をBefore/Afterで可視化。**なぜ変わったかが一目瞭然**です。」

**3. 企業カスタマイズ可能なポリシーエンジン**
- 「判定ルールはJSONファイルに分離。**税理士がコードを書かずにルールを変更**できます。」
- 「設備会社向け、IT企業向け、製造業向け — 同じエンジンで業種別の判定が可能です。」

**4. 税務知識の体系的注入**
- 「単なるOCRツールではありません。**日本の税法（少額資産特例、資本的支出vs修繕費）をAIに教え込んだ**専門ツールです。」

### 審査員が聞きたいQ&A想定

| 質問 | 推奨回答 |
|------|---------|
| 「GUIDANCE多すぎて使い物にならないのでは？」 | 「確信度の高い案件（10万円未満の消耗品等）は即座にEXPENSE_LIKE判定します。GUIDANCEは金額帯が微妙な場合や情報不足時のみ。**止まるべきところで止まり、進めるところは進む**設計です。」 |
| 「ルールベースだけでいいのでは？LLMの意味は？」 | 「見積書の記述は表記揺れが激しく、ルールベースだけでは『エアコン更新工事一式』のような複合案件に対応できません。LLMが**文脈を理解し、ルールが安全弁として機能**する二段構えです。」 |
| 「精度はどのくらい？」 | 「現時点では定量評価基盤を構築中です。ただし**精度100%を目指すのではなく、不確実な案件を確実にGUIDANCEに回す設計**にしています。税理士の判断が必要な案件を見逃さないことが最優先です。」 |
| 「他の会計AIと何が違う？」 | 「多くの会計AIは『判定を自動化する』ツールです。私たちは『**AIと人間が協力して判定を完成させる**』Agenticツールです。AIが止まる→質問する→変わるの3フェーズが違いです。」 |

---

## 不足している差別化と追加提案

### 不足1: 定量的な精度評価基盤（影響度: 高）

**現状**: 判定精度のベンチマークが存在しない。
**先行事例**: 記事5（900件検証で約80%精度を実証）。
**提案**: テストデータセット（20-30件の見積書・請求書JSON）を用意し、判定精度・GUIDANCE率・誤判定率を計測。ハッカソンデモで「GUIDANCE率XX%、誤判定率0%」と示せれば説得力が段違い。
**実装コスト**: 低（テストデータ作成 + pytest 1ファイル）

### 不足2: 判定根拠の元文書ハイライト（影響度: 中）

**現状**: 判定理由はテキスト表示のみ。元PDFの該当箇所のハイライトなし。
**先行事例**: 記事9（座標ベースの視覚的検証UI）。
**提案**: Gemini Vision抽出時の座標データを活用し、元PDFのどの部分から判定したかをハイライト表示。
**実装コスト**: 高（Geminiの座標出力対応 + PDF.js表示）。ハッカソンスコープ外だが「将来構想」として言及する価値あり。

### 不足3: similar_caseの充実（影響度: 中）

**現状**: `guidance_panel.py` に `similar_case` 表示機能があるが、Gemini APIからの返却に依存しており安定しない。
**提案**: 固定的な類似事例テンプレート（「エアコン更新工事 → 資本的支出」等）をJSONで用意し、キーワードマッチで表示。ユーザーの判断を助ける「セレンディピティ」効果。
**実装コスト**: 低（JSONテンプレート + マッチングロジック）

### 不足4: APIレスポンスのdisclaimer連動（影響度: 低）

**現状**: `api/main.py` に `disclaimer` フィールドが実装済み（確信度90%超で追加文言あり）。
**提案**: UI側でdisclaimerをresult_cardに連動表示。「高確信度でも必ず専門家確認」のメッセージを動的に切替。
**実装コスト**: 極低（UI側の表示ロジック追加のみ）

---

## 差別化強化のための推奨アクション

### 即時実行可能（ハッカソンデモ前）

| # | アクション | 効果 | 工数 |
|---|-----------|------|------|
| 1 | テストデータ20件でベンチマーク実行 | 「誤判定0%、GUIDANCE率XX%」の数値で差別化を実証 | 2-3時間 |
| 2 | similar_caseのJSONテンプレート追加 | GUIDANCEパネルのセレンディピティ効果強化 | 1-2時間 |
| 3 | ピッチ資料に「Stop-first vs Fail-to-Answer」の比較図 | 審査員への一発理解 | 30分 |

### 短期（1-2日）

| # | アクション | 効果 | 工数 |
|---|-----------|------|------|
| 4 | Few-shot例をGeminiプロンプトに追加 | 判定安定性向上（先行事例で効果実証済） | 3-4時間 |
| 5 | 複数企業ポリシーのサンプル追加 | ポリシーエンジンの拡張性デモ | 1時間 |
| 6 | disclaimerのUI連動表示 | 信頼設計の可視化 | 1時間 |

### 中期（将来構想として言及）

| # | アクション | 効果 |
|---|-----------|------|
| 7 | 座標ベース元文書ハイライト | 「なぜこの判定か」の究極的可視化 |
| 8 | ユーザーフィードバックループ | 判定精度の継続的向上 |
| 9 | FastAPIのMCP対応 | 他AIエージェントからの呼び出し可能性 |
| 10 | LLM蒸留による推論コスト削減 | 大量処理時のスケーラビリティ |

---

## 総括

fixed-asset-ashigaruの最大の差別化は**Stop-first設計**である。先行22件の全ツールが「判定を返す」設計の中、唯一「判定しない」という選択肢を持つ。これは技術的な弱さではなく、**税務ドメインにおける安全設計の表現**である。

この差別化を最大化するには:
1. **数字で証明する**（ベンチマーク: 誤判定率0%のデータ）
2. **体験で伝える**（デモ: GUIDANCEパネルの2段階ウィザードを見せる）
3. **対比で際立たせる**（ピッチ: 他ツールのFail-to-Answer vs 本ツールのFail-to-GUIDANCE）

「AIが止まれることは、AIが正しく動いていることの証拠です」— これがハッカソン審査員への最も強いメッセージとなる。
